<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clean Language Report</title>
</head>
<body style="font-family:Helvetica">
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_3"><br>Chapter 3<br><br>Defining Functions and Constants</a></h1></div>
<p style="text-align:justify;">In this Chapter we explain how functions (actually: <i>graph rewrite rules</i>) and constants (actually: graph expressions) are defined in CLEAN. The body of a function consists of an (root) expression (<span style="color:blue;"><a href="#_3.4">see 3.4</a></span>). With help of patterns (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) and guards  (<span style="color:blue;"><a href="#_3.3">see 3.3</a></span>) a distinction can be made between several alternative definitions for a function. Functions and constants can be defined locally in a function definition. For programming convenience (forcing evaluation, observation of unique objects and threading of sequencial operations) a special let construction is provided (<span style="color:blue;"><a href="#_3.5.1">see 3.5.1</a></span>). The typing of functions is discussed in <span style="color:blue;"><a href="#_3.7">Section 3.7</a></span>. For overloaded functions see <span style="color:blue;"><a href="CleanLanguageReport6.html#_6">Chapter 6</a></span>. For functions working on unique datatypes <span style="color:blue;"><a href="CleanLanguageReport9.html#_9">see Chapter 9</a></span>.</p>
<h2 style="background-color:#9999FF;"><a id="_3.1">3.1 Functions</a></h2>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">[FunctionTypeDef]</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4">see Chapter 4 for typing functions</a></span></td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">DefOfFunction</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">DefOfFunction</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">{FunctionAltDef <span style="font-family:courier;color:#0000FF;"><b>;</b></span>}+</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionAltDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">Function {Pattern}</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.2">see 3.2 for patterns</a></span></td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">{GuardAlt}</td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">{LetBeforeExpression}</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.5.4">see 3.5.4</a></span></td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">FunctionResult</td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">[LocalFunctionAltDefs]</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.5">see 3.5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionResult</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3"><span style="font-family:courier;color:#993300;"><b>=</b></span>[<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard GuardRhs</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.3">see 3.3 for guards</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">GuardAlt</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr GuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">GuardRhs</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">{GuardAlt} {LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">{GuardAlt} {LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> GuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Function</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;">FunctionName</span></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// ordinary function</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// operator function used prefix</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionBody</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">RootExpression <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.4">see 3.4</a></span></td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">[LocalFunctionDefs]</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.5">see 3.5</a></span></td></tr>
</table><p></p>
<p style="text-align:justify;">A <i>function definition</i> consists of one or more definition of a <i>function alternative</i> (rewrite rule). On the left-hand side of such a function alternative a <i>pattern</i> can be specified which can serve a whole sequence of <i>guarded function bodies</i> (called the <i>rule alternatives</i>) The root expression (<span style="color:blue;"><a href="#_3.4">see 3.4</a></span>) of a particular rule alternative is chosen for evaluation when</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">the patterns specified in the formal arguments are matching the corresponding actual arguments of the function application (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) <i>and</i></td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">the optional <i>guard</i> (<span style="color:blue;"><a href="#_3.3">see 3.3</a></span>) specified on the right-hand side evaluates to <span style="font-family:courier;">True</span>.</td></tr></table>
<p style="text-align:justify;"> The alternatives are tried in textual order. A function can be preceded by a definition of its type (<span style="color:blue;"><a href="#_3.7">Section 3.7</a></span>).</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Function definitions are only allowed in implementation modules (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2.3">see 2.3</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is required that the function alternatives of a function are textually grouped together (separated by semi-colons when the layout sensitive mode is not chosen).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Each alternative of a function must start with the same function symbol.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A function has a fixed arity, so in each rule the same number of formal arguments must be specified. Functions can be used curried and applied to any number of arguments though, as usual in higher order functional languages.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The function name must in principle be different from other names in the same name space and same scope (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2.1">see 2.1</a></span>). However, it is possible to overload functions and operators (<span style="color:blue;"><a href="CleanLanguageReport6.html#_6">see Chapter 6</a></span>).</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">Example of function definitions in a CLEAN module.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;example&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;module&nbsp;header</span><br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;StdInt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;implicit&nbsp;import</span><br>
<br>
map::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;map</span><br>
map&nbsp;f&nbsp;list&nbsp;=&nbsp;[f&nbsp;e&nbsp;\\&nbsp;e&nbsp;&lt;-&nbsp;list]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;the&nbsp;function&nbsp;map</span><br>
<br>
Start::&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;Start&nbsp;rule</span><br>
Start&nbsp;=&nbsp;map&nbsp;square&nbsp;[1..1000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;the&nbsp;Start&nbsp;rule</span><br></div>
<p></p><p style="text-align:justify;">An <i>operator</i> is a <i>function with arity two</i> that can be used as infix operator (brackets are left out) or as ordinary prefix function (the operator name preceding its arguments has to be surrounded by brackets). The <i>precedence</i> (<span style="font-family:courier;">0</span> through <span style="font-family:courier;">9</span>) and <i>fixity</i> (<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>eft, <span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>ight, <span style="font-family:courier;color:#FF0000;"><b>infix</b></span>) that can be defined in the type definition (<span style="color:blue;"><a href="#_3.7.1">see 3.7.1</a></span>) of the operators determine the priority of the operator application in an expression. A higher precedence binds more tightly. When operators have equal precedence, the fixity determines the priority.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When an operator is used in infix position <i>both</i> arguments have to be present. Operators can be used in a curried way, but then they have to be used as ordinary prefix functions.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">Operator definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(++)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>&nbsp;0::&nbsp;[a]&nbsp;[a]&nbsp;-&gt;&nbsp;[a]<br>
(++)&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ly&nbsp;&nbsp;=&nbsp;ly<br>
(++)&nbsp;[x:xs]&nbsp;&nbsp;ly&nbsp;&nbsp;=&nbsp;[x:xs&nbsp;++&nbsp;ly]<br>
<br>
(o)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>&nbsp;9::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(c&nbsp;-&gt;&nbsp;a)&nbsp;-&gt;&nbsp;(c&nbsp;-&gt;&nbsp;b)<br>
(o)&nbsp;f&nbsp;g&nbsp;=&nbsp;\x&nbsp;=&nbsp;f&nbsp;(g&nbsp;x)<br></div>
<p></p><h2 style="background-color:#9999FF;"><a id="_3.2">3.2 Patterns</a></h2>
<p style="text-align:justify;">A <i>pattern</i> specified on the left-hand side of a function definition specifies the formal arguments of a function. A function alternative is chosen only if the actual arguments of the function application match the formal arguments. A formal argument is either a constant (some <i>data constructor</i> with its optional arguments that can consist of sub-patterns) or it is a variable.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Pattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">[<span style="font-family:courier;">Variable</span> <span style="font-family:courier;color:#993300;"><b>=:</b></span>] BrackPattern</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">BrackPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3"><span style="font-family:courier;color:#993300;"><b>(</b></span>GraphPattern<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">QConstructor</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">PatternVariable</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">SpecialPattern</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:28.8745454545455%;padding:0 0 4px 0;">DynamicPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:40.9745454545455%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport8.html#_8">see Chapter 8</a></span></td></tr>
<tr><td style="width:100.000606060606%;padding:0 0 4px 0;" colspan="7"></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">GraphPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:28.8745454545455%;padding:0 0 4px 0;">QConstructor {Pattern}</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:40.9745454545455%;padding:0 0 4px 0;"><span style="font-family:courier;color:#0000FF;">// Ordinary data constructor</span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:28.8745454545455%;padding:0 0 4px 0;">GraphPattern <span style="font-family:courier;">QConstructorName</span></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:40.9745454545455%;padding:0 0 4px 0;"><span style="font-family:courier;color:#0000FF;">// Infix data constructor</span></td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">GraphPattern </td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">Pattern </td></tr>
<tr><td style="width:100.000606060606%;padding:0 0 4px 0;" colspan="7"></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">PatternVariable</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3"><span style="font-family:courier;">Variable</span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3"><span style="font-family:courier;color:#993300;"><b>_ </b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">A <i>pattern variable</i> can be a (node) <i>variable</i> or a <i>wildcard</i>. A <i>variable</i> is a formal argument of a function that matches on <i>any</i> concrete value of the corresponding actual argument and therefore it does <i>not</i> force evaluation of this argument. A <i>wildcard</i> is an <i>anonymous</i> variable ("_") one can use to indicate that the corresponding argument is not used in the right-hand side of the function. A <i>variable</i> can be attached to a pattern (using the symbol '<span style="font-family:courier;">=:</span>') that makes it possible to identify (<i>label</i>) the whole pattern as well as its contents. When a constant (data constructor) is specified as formal argument, the actual argument must contain the same constant in order to have a successful match.</p>
<p></p><div style="background-color:#FFFF45;">Example of an algebraic data type definition and its use in a pattern match in a function definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Nil<br>
<br>
Mirror::&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;Tree&nbsp;a<br>
Mirror&nbsp;(Node&nbsp;e&nbsp;left&nbsp;right)&nbsp;=&nbsp;Node&nbsp;e&nbsp;(Mirror&nbsp;right)&nbsp;(Mirror&nbsp;left)<br>
Mirror&nbsp;Nil&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Nil<br></div>
<p></p><p></p><div style="background-color:#FFFF45;">Use of anonymous variables.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;Complex&nbsp;:==&nbsp;(!Real,!Real)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;synonym&nbsp;type&nbsp;def</span><br>
<br>
realpart::&nbsp;Complex&nbsp;-&gt;&nbsp;Real<br>
realpart&nbsp;(re,_)&nbsp;=&nbsp;re&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;re&nbsp;and&nbsp;_&nbsp;are&nbsp;pattern&nbsp;variables</span><br></div>
<p></p><p></p><div style="background-color:#FFFF45;">Use of list patterns, use of guards, use of variables to identify patterns and sub-patterns; merge merges two (sorted) lazy lists into one (sorted) list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
merge::&nbsp;[Int]&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
merge&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;=&nbsp;f<br>
merge&nbsp;[]&nbsp;s&nbsp;&nbsp;&nbsp;=&nbsp;s<br>
merge&nbsp;f=:[x:xs]&nbsp;s=:[y:ys]<br>
|&nbsp;x&lt;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[x:merge&nbsp;xs&nbsp;s]<br>
|&nbsp;x==y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;merge&nbsp;f&nbsp;ys<br>
|&nbsp;otherwise&nbsp;&nbsp;=&nbsp;[y:merge&nbsp;f&nbsp;ys]<br></div>
<p></p><p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is possible that the specified patterns turn a function into a partial function (<span style="color:blue;"><a href="#_3.7.3">see 3.7.3</a></span>). When a partial function is applied outside the domain for which the function is defined it will result into a <i>run-time</i> error. A compile time <i>warning</i> is generated that such a situation might arise.</td></tr>
</table>
<p style="text-align:justify;">The formal arguments of a function and the function body are contained in a new local scope.</p>
<div style="position: absolute;height:2.25em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 36" width="100%" height="100%">
<path d="M121.244444444444 1.5 h316.8 v16.5 h-316.8 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">functionName&nbsp;args&nbsp;=&nbsp;expression<br><p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All variable symbols introduced at the left-hand side of a function definition must have different names.</td></tr>
</table>
<p style="text-align:justify;">For convenience and efficiency special syntax is provided to express pattern match on data structures of predefined type and record type. They are treated elsewhere (see below).</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">SpecialPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">BasicValuePattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.1.2">see 4.1.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">ListPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.2.2">see 4.2.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">TuplePattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.3.2">see 4.3.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">ArrayPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.4.2">see 4.4.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">RecordPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport5.html#_5.2.2">see 5.2.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">UnitPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.8">see 4.8</a></span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_3.3">3.3 Guards</a></h2>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Guard</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">BooleanExpr</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">A <i>guard</i> is a Boolean expression attached to a rule alternative that can be regarded as generalisation of the pattern matching mechanism: the alternative only matches when the patterns defined on the left hand-side match <i>and</i> its (optional) guard evaluates to <span style="font-family:courier;">True</span> (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>). Otherwise the <i>next</i> alternative of the function is tried. Pattern matching always takes place <i>before</i> the guards are evaluated.</p>
<p style="text-align:justify;">The guards are tried in <i>textual order</i>. The alternative corresponding to the first guard that yields <span style="font-family:courier;">True</span> will be evaluated. A right-hand side without a guard can be regarded to have a guard that always evaluates to <span style="font-family:courier;">True</span>(the 'otherwise' or 'default' case). In <span style="font-family:courier;">keyword</span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> is synonym for <span style="font-family:courier;">True</span> for people who like to emphasize the default option.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Only the last rule alternative of a function can have otherwise as guard or can have no guard.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is possible that the guards turn the function into a partial function (<span style="color:blue;"><a href="#_3.7.3">see 3.7.3</a></span>). When a partial function is applied outside the domain for which the function is defined it will result into a <i>run-time</i> error. At compile time this cannot be detected.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">Function definition with guards.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
filter::&nbsp;Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
filter&nbsp;pr&nbsp;[n:str]<br>
|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;str<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;str]<br></div>
<p></p><p></p><div style="background-color:#FFFF45;">Equivalent definition of previous <span style="font-family:courier;">filter</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
filter::&nbsp;Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
filter&nbsp;pr&nbsp;[n:str]<br>
|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;str<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;str]<br></div>
<p></p><p style="text-align:justify;">Guards can be nested. When a guard on one level evaluates to <span style="font-family:courier;">True</span>, the guards on a next level are tried.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">To ensure that at least one of the alternatives of a nested guard will be successful, a nested guarded alternative must always have a 'default case' as last alternative.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">Example of a nested guard. </div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
example&nbsp;arg1&nbsp;arg2<br>
|&nbsp;predicate11&nbsp;arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;if&nbsp;predicate11&nbsp;arg1</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;predicate21&nbsp;arg2&nbsp;=&nbsp;calculate1&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;&nbsp;then&nbsp;(if&nbsp;predicate21&nbsp;arg2</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;predicate22&nbsp;arg2&nbsp;=&nbsp;calculate2&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;&nbsp;elseif&nbsp;predicate22&nbsp;arg2&nbsp;then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;calculate3&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;&nbsp;else&nbsp;...)</span><br>
|&nbsp;predicate12&nbsp;arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;calculate4&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;elseif&nbsp;predicate12&nbsp;arg1&nbsp;then&nbsp;...</span><br></div>
<p></p><h2 style="background-color:#9999FF;"><a id="_3.4">3.4 Expressions</a></h2>
<p style="text-align:justify;">The main body of a function is called the <i>root expression</i>. The root expression is a graph expression.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">RootExpression</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">GraphExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">GraphExpr</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">Application</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Application</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">{BrackGraph}+</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">GraphExpr Operator GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">GenericAppExpr</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">BrackGraph</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">GraphVariable</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">QConstructor</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">QFunction</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">(GraphExpr)</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">LambdaAbstr</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.4.1">see 3.4.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">CaseExpr</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.4.2">see 3.4.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">LetExpression</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.5.1">see 3.5.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">SpecialExpression</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">DynamicExpression</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">MatchesPatternExpr</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.4.2">see 3.4.2</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">QFunction</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;">QFunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">QFunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">QConstructor</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;">QConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">QConstructorName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Operator</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;">QFunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;">QConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">GraphVariable</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;">Variable</span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">SelectorVariable</td></tr>
</table><p></p>
<p style="text-align:justify;">An expression generally expresses an application of a function to its actual arguments or the (automatic) creation of a data structure simply by applying a data constructor to its arguments. Each function or data constructor can be used in a <i>curried</i> way and can therefore be applied to any number (zero or more) of arguments. A function will only be rewritten if it is applied to a number of arguments equal to the arity of the function (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>). Function and constructors applied on zero arguments just form a syntactic unit (for non-operators no brackets are needed in this case).</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All expressions have to be of correct type (<span style="color:blue;"><a href="CleanLanguageReport5.html#_5">see Chapter 5</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All symbols that appear in an expression must have been defined somewhere within the scope in which the expression appears (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2.1">see 2.1</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">There has to be a definition for each node variable and selector variable within in the scope of the graph expression.</td></tr>
</table>
<p style="text-align:justify;"><i>Operators</i> are special functions or data constructors defined with arity two which can be applied in infix position  The <i>precedence</i> (<span style="font-family:courier;">0</span> through <span style="font-family:courier;">9</span>) and <i>fixity</i> (<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>eft, <span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>ight, <span style="font-family:courier;color:#FF0000;"><b>infix</b></span>) which can be defined in the type definition of the operators determine the priority of the operator application in an expression. A higher precedence binds more tightly. When operators have equal precedence, the fixity determines the priority. In an expression an ordinary function application has a very high priority (<span style="font-family:courier;">10</span>). Only selection of record elements (<span style="color:blue;"><a href="CleanLanguageReport5.html#_5.2.1">see 5.2.1</a></span>) and array elements (<span style="color:blue;"><a href="CleanLanguageReport4.html#_4.4.1">see 4.4.1</a></span>) binds more tightly (<span style="font-family:courier;">11</span>). Besides that, due to the priority, brackets can sometimes be omitted; operator applications behave just like other applications.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is not allowed to apply operators with equal precedence in an expression in such a way tha  their fixity conflict. So, when in <span style="font-family:courier;">a1 op1 a2 op2 a3</span> the operators <span style="font-family:courier;">op1</span> and <span style="font-family:courier;">op2</span> have the same precedence a conflict arises when <span style="font-family:courier;">op1</span> is defined as infixr implying that the expression must be read as <span style="font-family:courier;">a1</span> <span style="font-family:courier;">op1</span> <span style="font-family:courier;">(a2</span> <span style="font-family:courier;">op2</span> <span style="font-family:courier;">a3)</span> while <span style="font-family:courier;">op2</span> is defined as <span style="font-family:courier;">infixl</span> implying that the expression must be read as <span style="font-family:courier;">(a1</span> <span style="font-family:courier;">op1</span> <span style="font-family:courier;">a2)</span> <span style="font-family:courier;">op2</span> <span style="font-family:courier;">a3</span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When an operator is used in infix position <i>both</i> arguments have to be present. Operators can be used in a <i>curried</i> way (applied to less than two arguments), but then they have to be used as ordinary <i>prefix</i> functions / constructors. When an operator is used as prefix function c.q. constructor, it has to be surrounded by brackets.</td></tr>
</table>
<p style="text-align:justify;">There are two kinds of variables that can appear in a graph expression: <i>variables</i> introduced as <i>formal argument</i> of a function (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span> and <span style="color:blue;"><a href="#_3.2">3.2</a></span>) and <i>selector variables</i> (defined in a <i>selector</i> to identify parts of a graph expression, <span style="color:blue;"><a href="#_3.6">see 3.6</a></span>).</p>
<p></p><div style="background-color:#FFFF45;">Example of a cyclic root expression. y is the root expression referring to a cyclic graph. The multiplication operator * is used prefix here in a curried way.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
ham::&nbsp;[Int]<br>
ham&nbsp;=&nbsp;y<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;y&nbsp;=&nbsp;[1:merge&nbsp;(map&nbsp;((*)&nbsp;2)&nbsp;y)&nbsp;(merge&nbsp;(map&nbsp;((*)&nbsp;3)&nbsp;y)&nbsp;(map&nbsp;((*)&nbsp;5)&nbsp;y))]<br></div>
<p></p><p style="text-align:justify;">For convenience and efficiency special syntax is provided to create expressions of data structures of predefined type and of record type that is considered as a special kind of algebraic type. They are treated in elsewhere.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">SpecialExpression</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">BasicValue</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.1.1">see 4.1.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">List</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.2.1">see 4.2.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">Tuple</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.3.1">see 4.3.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">Array</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.4.1">see 4.4.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">ArraySelection</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.4.1">see 4.4.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">Record</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport5.html#_5.2.1">see 5.2.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">RecordSelection</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport5.html#_5.2.1">see 5.2.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">UnitConstructor</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.8">see 4.8</a></span></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_3.4.1">3.4.1 Lambda Abstraction</a></h3>
<p style="text-align:justify;">Sometimes it can be convenient to define a tiny function in an expression "right on the spot". For this purpose one can use a <i>lambda abstraction</i>. An anonymous function is defined which can have several formal arguments that can be patterns as common in ordinary function definitions (<span style="color:blue;"><a href="#_3">see Chapter 3</a></span>). However, only simple functions can be defined in this way: no rule alternatives, and no local function definitions.</p>
<p style="text-align:justify;">It is also allowed to use the arrow ('<span style="font-family:courier;">-&gt;</span>') to separate  the  formal  arguments from the function body:</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LambdaAbstr</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>\</b></span> {Pattern}+ {LambdaGuardAlt} {LetBeforeExpression} LambdaResult</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LambdaResult</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>= </b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard LambdaGuardRhs</td></tr>
</table><p></p>
<p></p><div style="background-color:#FFFF45;">Example of a Lambda expression.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
AddTupleList::&nbsp;[(Int,Int)]&nbsp;-&gt;&nbsp;[Int]<br>
AddTupleList&nbsp;list&nbsp;=&nbsp;map&nbsp;((x,y)&nbsp;=&nbsp;x+y)&nbsp;list<br></div>
<p></p><p style="text-align:justify;">A lambda expression introduces a new scope (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2.1">see 2.1</a></span>).</p>
<div style="background-color:#FFFF45;">The arguments of the anonymous function being defined have the only a meaning in the corresponding function body.</div>
<div style="position: absolute;height:3.375em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 54" width="100%" height="100%">
<path d="M15.6444444444444 18 h336 v16.5 h-336 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
\&nbsp;arg1&nbsp;arg2&nbsp;...&nbsp;argn&nbsp;=&nbsp;function_body<br><p style="text-align:justify;">Let-before expressions and guards can be used in lambda abstractions:</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LambdaGuardAlt</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr LambdaGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LambdaGuardRhs</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{LambdaGuardAlt} {LetBeforeExpression} LambdaGuardResult</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LambdaGuardResult</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>= </b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> LambdaGuardRhs</td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_3.4.2">3.4.2 Case Expression and Conditional Expression</a></h3>
<p style="text-align:justify;">For programming convenience a <i>case expression</i> and <i>conditional expression</i> are added.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">CaseExpr</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#FF0000;"><b>case</b></span> GraphExpr <span style="font-family:courier;color:#FF0000;"><b>of</b></span></td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#0000FF;"><b>{</b></span> {CaseAltDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#FF0000;"><b>if</b></span> BrackGraph BrackGraph BrackGraph</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">CaseAltDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{Pattern}</td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{CaseGuardAlt} {LetBeforeExpression} CaseResult</td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[LocalFunctionAltDefs]</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">CaseResult</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard CaseGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">CaseGuardAlt</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr CaseGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">CaseGuardRhs</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{CaseGuardAlt} {LetBeforeExpression} CaseGuardResult</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">CaseGuardResult</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> CaseGuardRhs</td></tr>
</table><p></p>
<p style="text-align:justify;">In a <i>case expression</i> first the discriminating expression is evaluated after which the case alternatives are tried in textual order. Case alternatives are similar to function alternatives. This is not so strange because a case expression is internally translated to a function definition (see the example below). Each alternative contains a left-hand side pattern (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) that is optionally followed by a <i>let-before</i> (<span style="color:blue;"><a href="#_3.5.4">see 3.5.4</a></span>) and a guard (<span style="color:blue;"><a href="#_3.3">see 3.3</a></span>). When a pattern matches and the optional guard evaluates to <span style="font-family:courier;">True</span> the corresponding alternative is chosen. A new block structure (scope) is created for each case alternative (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2.1">see 2.1</a></span>).</p>
<p style="text-align:justify;">It is also allowed to use the arrow ('<span style="font-family:courier;">-&gt;</span>') to separate the case alternatives</p>
<div style="background-color:#FFFF45;">The variables defined in the patterns have the only a meaning in the corresponding alternative.</div>
<div style="position: absolute;height:6.75em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 108" width="100%" height="100%">
<path d="M34.8444444444444 16.5 h249.6 v16.5 h-249.6 Z" fill="none" stroke="#000000"/>
<path d="M34.8444444444444 36 h249.6 v15 h-249.6 Z" fill="none" stroke="#000000"/>
<path d="M34.8444444444444 72 h249.6 v16.5 h-249.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>case</b></span>&nbsp;expression&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;pattern1&nbsp;=&nbsp;alternative1<br>
&nbsp;&nbsp;&nbsp;&nbsp;pattern2&nbsp;=&nbsp;alternative2<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;patternn&nbsp;=&nbsp;alternativen<br><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All alternatives in the case expression must be of the same type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When none of the patterns matches a <i>run-time</i> error is generated.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">The case expression</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h&nbsp;x&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>case</b></span>&nbsp;g&nbsp;x&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[hd:_]&nbsp;&nbsp;=&nbsp;hd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"result&nbsp;of&nbsp;call&nbsp;g&nbsp;x&nbsp;in&nbsp;h&nbsp;is&nbsp;empty"<br>
<br></div>
<div style="background-color:#FFFF45;">is semantically equivalent to:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h&nbsp;x&nbsp;=&nbsp;mycase&nbsp;(g&nbsp;x)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;mycase&nbsp;&nbsp;[hd:_]&nbsp;&nbsp;=&nbsp;hd<br>
&nbsp;&nbsp;&nbsp;&nbsp;mycase&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"result&nbsp;of&nbsp;call&nbsp;g&nbsp;x&nbsp;in&nbsp;h&nbsp;is&nbsp;empty"<br></div>
<p></p><p style="text-align:justify;">In a <i>conditional expression</i> first the Boolean expression is evaluated after which either the then- or the else-part is chosen. The conditional expression can be seen as a simple kind of case expression.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The then- and else-part in the conditional expression must be of the same type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The discriminating expression must be of type <span style="font-family:courier;">Bool</span>.</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_3.4.3">3.4.3 Matches Pattern Expression</a></h3>
<p style="text-align:justify;"><span style="font-family:courier;">expression</span> <span style="font-family:courier;">=:</span> <span style="font-family:courier;">pattern</span> in an expression yields <span style="font-family:courier;">True</span> if the <span style="font-family:courier;">expression</span> matches the <span style="font-family:courier;">pattern</span> and <span style="font-family:courier;">False</span> otherwise. Variable names are not allowed in the <span style="font-family:courier;">pattern</span>, but <span style="font-family:courier;">_</span>'s may be used. The compiler converts the expression to a case if the pattern is more complicated than just a constructor and <span style="font-family:courier;">_</span>'s.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">MatchesPatternExpr</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">GraphExpr <span style="font-family:courier;color:#993300;"><b>=:</b></span> <span style="font-family:courier;">QConstructorName</span> { <span style="font-family:courier;color:#993300;"><b>_</b></span> }</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">GraphExpr <span style="font-family:courier;color:#993300;"><b>=:</b></span> BrackPattern</td></tr>
</table><p></p>
<p style="text-align:justify;"><span style="font-family:courier;">=:</span> in expressions binds stronger than function application. This includes additional <span style="font-family:courier;">_</span>'s after a <span style="font-family:courier;">ConstructorName</span>, so <span style="font-family:courier;">x=:(Constructor _ _)</span> may be written without parenthesis as <span style="font-family:courier;">x=:Constructor _ _</span>, for example:</p>
<p></p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;T&nbsp;=&nbsp;X&nbsp;Int&nbsp;|&nbsp;Y&nbsp;Int&nbsp;Int&nbsp;|&nbsp;Z<span style="font-family:courier;color:#0000FF;"><b>;</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;algebraic&nbsp;type&nbsp;definition&nbsp;</span><br>
<br>
isXorY&nbsp;t&nbsp;&nbsp;=&nbsp;&nbsp;t=:X&nbsp;_&nbsp;||&nbsp;t=:Y&nbsp;_&nbsp;_<span style="font-family:courier;color:#0000FF;"><b>;</b></span><br><p></p>
<h2 style="background-color:#9999FF;"><a id="_3.5">3.5 Local Definitions</a></h2>
<p style="text-align:justify;">Sometimes it is convenient to introduce definitions that have a limited scope and are not visible throughout the whole module. One can define <i>functions</i> that have a local scope, i.e. which have only a meaning in a certain program region.</p>
<p style="text-align:justify;">Outside the scope the functions are unknown. This locality can be used to get a better program structure: functions that are only used in a certain program area can remain hidden outside that area.</p>
<p style="text-align:justify;">Besides functions one can also define constant selectors. Constants are named graph expressions (<span style="color:blue;"><a href="#_3.6">see 3.6</a></span>).</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LocalDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">FunctionDef</td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_3.5.1">3.5.1 Let Expression: Local Definitions in Expressions</a></h3>
<p style="text-align:justify;">A <i>let</i> expression is an expression that enables to introduce a new scope (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2.1">see 2.1</a></span>)  in an expression in which local functions and constants can be defined. Such local definitions can be introduced anywhere in an expression using a let expression with the following syntax.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LetExpression</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#FF0000;"><b>let</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span> <span style="font-family:courier;color:#FF0000;"><b>in</b></span> GraphExpr</td></tr>
</table><p></p>
<div style="background-color:#FFFF45;">The function and selectors defined in the let block only have a meaning within the <i>expression</i>.</div>
<div style="position: absolute;height:7.875em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 126" width="100%" height="100%">
<path d="M0 18 h374.4 v88.5 h-374.4 Z" fill="none" stroke="#000000"/>
<path d="M121.244444444444 36 h249.6 v16.5 h-249.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
<span style="font-family:courier;color:#FF0000;"><b>let</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;arguments&nbsp;=&nbsp;function_body<br>
&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
<span style="font-family:courier;color:#FF0000;"><b>in</b></span>&nbsp;&nbsp;expression<br><p></p><div style="background-color:#FFFF45;">Example of a let expression used within a list comprehension.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
doublefibs&nbsp;n&nbsp;=&nbsp;[<span style="font-family:courier;color:#FF0000;"><b>let</b></span>&nbsp;a&nbsp;=&nbsp;fib&nbsp;i&nbsp;<span style="font-family:courier;color:#FF0000;"><b>in</b></span>&nbsp;(a,&nbsp;a)&nbsp;\\&nbsp;i&nbsp;&lt;-&nbsp;[0..n]]<br></div>
<p></p><h3 style="background-color:#9999FF;"><a id="_3.5.2">3.5.2 Where Block: Local Definitions in a Function Alternative</a></h3>
<p style="text-align:justify;">At the end of each function alternative one can locally define functions and constant graphs in a <i>where block</i>.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LocalFunctionAltDefs</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">Functions and graphs defined in a <i>where</i> block can be used anywhere in the corresponding function alternative (i.e. in all guards and rule alternatives following a pattern, <span style="color:blue;"><a href="#_3.1">see 3.1</a></span>) as indicated in the following picture showing the scope of a <i>where</i> block.</p>
<div style="background-color:#FFFF45;">The function and selectors defined in the where block can be used locally in the whole function definition.</div>
<div style="position: absolute;height:11.25em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 180" width="100%" height="100%">
<path d="M82.8444444444444 18 h393.6 v142.5 h-393.6 Z" fill="none" stroke="#000000"/>
<path d="M102.044444444444 34.5 h326.4 v16.5 h-326.4 Z" fill="none" stroke="#000000"/>
<path d="M102.044444444444 54 h326.4 v16.5 h-326.4 Z" fill="none" stroke="#000000"/>
<path d="M265.244444444444 126 h201.6 v16.5 h-201.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
function&nbsp;formal_arguments<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard1&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;function_alternative1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard2&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;function_alternative2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;default_alternative<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_function&nbsp;args&nbsp;=&nbsp;function_body<br>
<br><p></p><div style="background-color:#FFFF45;">sieve and filter are local functions defined in a where block. They have only a meaning inside primes. At the global level the functions are unknown.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
primes::[Int]<br>
primes&nbsp;=&nbsp;sieve&nbsp;[2..]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve::[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;primes</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve&nbsp;[pr:r]&nbsp;&nbsp;=&nbsp;[pr:sieve&nbsp;(filter&nbsp;pr&nbsp;r)]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;filter::Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;primes</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;filter&nbsp;pr&nbsp;[n:r]<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;r]<br></div>
<p></p><p style="text-align:justify;">Notice that the scope rules are such that the formal arguments of the surrounding function alternative are visible to the locally defined functions and graphs. The arguments can therefore directly be addressed in the local definitions. Such local definitions cannot always be typed explicitly (<span style="color:blue;"><a href="#_3.7">see 3.7</a></span>).</p>
<p></p><div style="background-color:#FFFF45;">Alternative definition of <span style="font-family:courier;">primes</span>. The function filter is locally defined for <span style="font-family:courier;">sieve</span>.<span style="font-family:courier;">filter</span> can directly access arguments <span style="font-family:courier;">pr</span> of <span style="font-family:courier;">sieve</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
primes::[Int]<br>
primes&nbsp;=&nbsp;sieve&nbsp;[2..]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve::[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;primes</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve&nbsp;[pr:r]&nbsp;&nbsp;=&nbsp;[pr:sieve&nbsp;(filter&nbsp;pr&nbsp;r)]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter::Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;sieve</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter&nbsp;pr&nbsp;[n:r]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;r]<br></div>
<p></p><h3 style="background-color:#9999FF;"><a id="_3.5.3">3.5.3 With Block: Local Definitions in a Guarded Alternative</a></h3>
<p style="text-align:justify;">One can also locally define functions and graphs at the end of each guarded rule alternative using a <i>with block</i>.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LocalFunctionDefs</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[<span style="font-family:courier;color:#FF0000;"><b>with</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LocalDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">FunctionDef</td></tr>
</table><p></p>
<p style="text-align:justify;">Functions and graphs defined in a <i>with</i> block can only be used in the corresponding rule alternative as indicated in the following picture showing the scope of a <i>with</i> block.</p>
<div style="background-color:#FFFF45;">The function and selectors defined in the <i>with</i> block can be locally only be used in the corresponding function alternative.</div>
<div style="position: absolute;height:14.625em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 234" width="100%" height="100%">
<path d="M82.8444444444444 21 h566.4 v190.5 h-566.4 Z" fill="none" stroke="#000000"/>
<path d="M246.044444444444 37.5 h398.933333333333 v75 h-398.933333333333 Z" fill="none" stroke="#000000"/>
<path d="M438.044444444444 91.5 h201.6 v16.5 h-201.6 Z" fill="none" stroke="#000000"/>
<path d="M246.044444444444 127.5 h398.933333333333 v75 h-398.933333333333 Z" fill="none" stroke="#000000"/>
<path d="M438.044444444444 181.5 h201.6 v16.5 h-201.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
function&nbsp;formal&nbsp;arguments<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;function_alternative1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>with</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_function&nbsp;args&nbsp;=&nbsp;function_body<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;function_alternative2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>with</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_function&nbsp;args&nbsp;=&nbsp;function_body<br>
<br><p style="text-align:justify;">Notice that the scope rules are such that the arguments of the surrounding guarded rule alternative are visible to the locally defined functions and graphs. The arguments can therefore directly be addressed in the local definitions. Such local definitions cannot always be typed explicitly (<span style="color:blue;"><a href="#_3.7">see 3.7</a></span>).</p>
<h3 style="background-color:#9999FF;"><a id="_3.5.4">3.5.4 Let-Before Expression: Local Constants defined between Guards</a></h3>
<p style="text-align:justify;">Many of the functions for input and output in the CLEAN I/O library are state transition functions. Such a state is often passed from one function to another in a single threaded way (<span style="color:blue;"><a href="CleanLanguageReport9.html#_9">see Chapter 9</a></span>) to force a specific order of evaluation. This is certainly the case when the state is of unique type. The threading parameter has to be renamed to distinguish its different versions. The following example shows a typical example:</p>
<p></p><div style="background-color:#FFFF45;">Use of state transition functions. The uniquely typed state file is passed from one function to another involving a number of renamings: file, file1, file2)</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
readchars::&nbsp;*File&nbsp;-&gt;&nbsp;([Char],&nbsp;*File)<br>
readchars&nbsp;file<br>
|&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],file1)<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;([char:chars],&nbsp;file2)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(ok,char,file1)&nbsp;&nbsp;&nbsp;=&nbsp;freadc&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;(chars,file2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;readchars&nbsp;file1<br></div>
<p></p><p style="text-align:justify;">This explicit renaming of threaded parameters not only looks very ugly, these kind of definitions are sometimes also hard to read as well (in which order do things happen? which state is passed in which situation?). We have to admit: an imperative style of programming is much easier to read when things have to happen in a certain order such as is the case when doing I/O. That is why we have introduced <i>let-before</i> expressions.</p>
<p style="text-align:justify;"><i>Let-before</i> expressions are special let expressions that can be defined before a guard or function body. In this way one can specify sequential actions in the order in which they suppose to happen. <i>Let-before</i> expressions have the following syntax:</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">LetBeforeExpression</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3"><span style="font-family:courier;color:#993300;"><b># </b></span>{GraphDefOrUpdate}+</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3"><span style="font-family:courier;color:#993300;"><b>#!</b></span>{GraphDefOrUpdate}+</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">GraphDefOrUpdate</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8692929292929%;padding:0 0 4px 0;" colspan="3">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:58.1709090909091%;padding:0 0 4px 0;">Variable <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {<span style="font-family:courier;">FieldName</span> {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:11.6781818181818%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport5.html#_5.2.1">see 5.2.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:58.1709090909091%;padding:0 0 4px 0;">Variable <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {ArrayIndex {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:11.6781818181818%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="CleanLanguageReport4.html#_4.4.1">see 4.4.1</a></span></td></tr>
</table><p></p>
<p style="text-align:justify;">The form with the exclamation mark (<span style="font-family:courier;">#!</span>) forces the evaluation of the node-ids that appear in the left-hand sides of the definitions. Notice that one can only define constant selectors (GraphDef) in a Let-before expression. One cannot define functions.</p>
<p style="text-align:justify;"><i>Let-before</i> expressions have a special scope rule to obtain an imperative programming look. The variables in the left-hand side of these definitions do not appear in the scope of the right-hand side of that definition, but they do appear in the scope of the other definitions that follow (including the root expression, excluding local definitions in where blocks.</p>
<div style="background-color:#FFFF45;">This is shown in the following picture:</div>
<div style="position: absolute;height:10.125em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 162" width="100%" height="100%">
<path d="M79.2888888888889 18 h270.577777777778 v124.5 h-270.577777777778 Z" fill="none" stroke="#000000"/>
<path d="M82.8444444444444 111L82.8444444444444 39L198.044444444444 39L198.044444444444 57L345.6 57L345.6 111 Z" fill="none" stroke="#000000"/>
<path d="M86.4 108L86.4 75L201.6 75L201.6 93L342.044444444444 93L342.044444444444 108 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
Function&nbsp;args<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;selector1&nbsp;&nbsp;=&nbsp;expression1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;expression2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;selector2&nbsp;&nbsp;=&nbsp;expression3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;expression4<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_definitions<br><p style="text-align:justify;">Notice that a variable defined in a let-before expression cannot be used in a where expression. The reverse is true however: definitions in the where expression can be used in the let before expression.</p>
<p></p><div style="background-color:#FFFF45;">Use of let before expressions, short notation, re-using names taking use of the special scope of the let before)</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
readchars::&nbsp;*File&nbsp;-&gt;&nbsp;([Char],&nbsp;*File)<br>
readchars&nbsp;file<br>
#&nbsp;&nbsp;&nbsp;(ok,char,file)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;freadc&nbsp;file<br>
|&nbsp;&nbsp;&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],file)<br>
#&nbsp;&nbsp;&nbsp;(chars,file)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;readchars&nbsp;file<br>
=&nbsp;&nbsp;&nbsp;([char:chars],&nbsp;file)<br></div>
<p></p><p></p><div style="background-color:#FFFF45;">Equivalent definition renaming threaded parameters</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
readchars::&nbsp;*File&nbsp;-&gt;&nbsp;([Char],&nbsp;*File)<br>
readchars&nbsp;file<br>
#&nbsp;&nbsp;&nbsp;(ok,char,file1)&nbsp;&nbsp;&nbsp;=&nbsp;freadc&nbsp;file<br>
|&nbsp;&nbsp;&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],file1)<br>
#&nbsp;&nbsp;&nbsp;(chars,&nbsp;file2)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;readchars&nbsp;file1<br>
=&nbsp;&nbsp;&nbsp;([char:chars],&nbsp;file2)<br></div>
<p></p><p style="text-align:justify;">The notation can also be dangerous: the same name is used on different spots while the meaning of the name is not always  the  same  (one has to  take  the  scope  into account which  changes  from  definition  to  definition).  However,  the notation  is  rather  safe  when  it  is  used  to  thread  parameters  of  unique  type.  The  type  system  will  spot  it  when  such parameters are not used in a correct single threaded manner. We do not recommend the use of let before expressions to adopt an imperative programming style for other cases.</p>
<p></p><div style="background-color:#FFFF45;">Abuse of let before expression.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
exchange::&nbsp;(a,&nbsp;b)&nbsp;-&gt;&nbsp;(b,&nbsp;a)<br>
exchange&nbsp;(x,&nbsp;y)<br>
#&nbsp;&nbsp;&nbsp;temp&nbsp;=&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;temp<br>
=&nbsp;&nbsp;&nbsp;(x,&nbsp;y)<br></div>
<p></p><h2 style="background-color:#9999FF;"><a id="_3.6">3.6 Defining Constants</a></h2>
<p style="text-align:justify;">One can give a name to a constant expression (actually a graph), such that the expression can be used in (and shared by) other expressions. One can also identify certain parts of a constant via a projection function called a selector (see below).</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">GraphDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">Selector <span style="font-family:courier;color:#993300;"><b>=</b></span>[<span style="font-family:courier;color:#993300;"><b>:</b></span>] GraphExpr <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p></p><div style="background-color:#FFFF45;">Graph locally defined in a function: the graph labeled <span style="font-family:courier;">last</span> is shared in the function <span style="font-family:courier;">StripNewline</span> and computed only once.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
StripNewline::&nbsp;String&nbsp;-&gt;&nbsp;String<br>
StripNewline&nbsp;""&nbsp;=&nbsp;""<br>
StripNewline&nbsp;string<br>
|&nbsp;string&nbsp;!!&nbsp;last&lt;&gt;'\n'&nbsp;=&nbsp;string<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;string%(0,last-1)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;last&nbsp;=&nbsp;maxindex&nbsp;string<br></div>
<p></p><p style="text-align:justify;">When a <i>graph</i> is <i>defined</i> actually a name is given to (part) of an expression. The definition of a graph can be compared with a definition of a <i>constant</i>(data) or a<i>constant</i> (<i>projection</i>) <i>function</i>. However, notice that graphs are constructed according to the basic semantics of CLEAN (<span style="color:blue;"><a href="CleanLanguageReport1.html#_1">see Chapter 1</a></span>) that means that multiple references to the same graph will result in <i>sharing</i> of that graph. Recursive references will result in <i>cyclic graph structures</i>. Graphs have the property that they <i>are computed only once</i> and that their value is <i>remembered</i>within the scope they are defined in.</p>
<p style="text-align:justify;">Graph definitions differ from constant function definitions. A <i>constant function definition</i> is just a function defined with arity zero (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>). A constant function defines an ordinary graph rewriting rule: multiple references to a function just means that the same definition is used such that a (constant) function <i>will be recomputed again</i> for each occurrence of <i>the function symbol made</i>. This difference can have consequences for the time and space behavior of function definitions (<span style="color:blue;"><a href="CleanLanguageReport10.html#_10.2">see 10.2</a></span>).</p>
<p></p><div style="background-color:#FFFF45;">The Hamming numbers defined using a locally defined cyclic constant graph and defined by using a globally defined recursive constant function. The first definition (ham1) is efficient because already computed numbers are reused via sharing. The second definition (ham2 ) is much more inefficient because the recursive function recomputes everything.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
ham1::&nbsp;[Int]<br>
ham1&nbsp;=&nbsp;y<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;y&nbsp;=&nbsp;[1:merge&nbsp;(map&nbsp;((*)&nbsp;2)&nbsp;y)&nbsp;(merge&nbsp;(map&nbsp;((*)&nbsp;3)&nbsp;y)&nbsp;(map&nbsp;((*)&nbsp;5)&nbsp;y))]<br>
<br>
ham2::&nbsp;[Int]<br>
ham2&nbsp;=&nbsp;[1:merge&nbsp;(map&nbsp;((*)&nbsp;2)&nbsp;ham2)&nbsp;(merge&nbsp;(map&nbsp;((*)&nbsp;3)&nbsp;ham2)&nbsp;(map&nbsp;((*)&nbsp;5)&nbsp;ham2&nbsp;))]<br></div>
<p></p><p style="text-align:justify;">Syntactically the definition of a graph is distinguished from the definition of a function by the symbol which separates the left-hand side from the right-hand side: "<span style="font-family:courier;">=</span>" or "<span style="font-family:courier;">=&gt;</span>" is used for functions, while "<span style="font-family:courier;">=</span>" is used for local graphs and "<span style="font-family:courier;">=:</span>" for global graphs. However, in general "<span style="font-family:courier;">=</span>" is used both for functions and local graphs. Generally it is clear from the context which is meant (functions have parameters, selectors are also easy recognisible). However, when a simple constant is defined the syntax is ambiguous (it can be a constant function definition as well as a constant graph definition).</p>
<p style="text-align:justify;">To allow the use of the "<span style="font-family:courier;">=</span>" whenever possible, the following rule is followed. Local constant definitions are <i>by default</i> taken to be <i>graph</i> definitions and therefore shared, globally they are <i>by default</i> taken to be <i>function</i> definitions (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>) and therefore recomputed. If one wants to obtain a different behavior one has to explicit state the nature of the constant definition (has it to be shared or has it to be recomputed) by using "<span style="font-family:courier;">=:</span>" (on the global level, meaning it is a constant graph which is shared) or "<span style="font-family:courier;">=&gt;</span>" (on the local level, meaning it is a constant function and has to be recomputed).</p>
<p></p><div style="background-color:#FFFF45;">Local constant graph versus local constant function definition: <span style="font-family:courier;">biglist1</span> and <span style="font-family:courier;">biglist2</span> is a <i>graph</i> which is computed only once, <span style="font-family:courier;">biglist3</span> is a constant <i>function</i> which is computed every time it is applied. </div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
biglist1&nbsp;=&nbsp;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;graph&nbsp;(if&nbsp;defined&nbsp;locally)</span><br>
biglist1&nbsp;=&nbsp;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;constant&nbsp;function&nbsp;(if&nbsp;defined&nbsp;globally)</span><br>
biglist2&nbsp;=:&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;graph&nbsp;(if&nbsp;defined&nbsp;globally)</span><br>
biglist3&nbsp;=&gt;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;constant&nbsp;function&nbsp;(always)</span><br></div>
<p></p><p style="text-align:justify;">The garbage collector will collect locally defined graphs when they are no longer connected to the root of the program graph (<span style="color:blue;"><a href="CleanLanguageReport1.html#_1">see Chapter 1</a></span>).</p>
<h3 style="background-color:#9999FF;"><a id="_3.6.1">3.6.1 Selectors</a></h3>
<p style="text-align:justify;">The left-hand side of a graph definition can be a simple name, but is can also be a more complicated pattern called a selector. A <i>selector</i> is a pattern which introduces one or more new <i>selector variables</i> implicitly defining <i>projection functions</i> to identify (parts of) a constant graph being defined One can identify the sub-graph as a whole or one can identify its components. A selector can contain constants (also user defined constants introduced by algebraic type definitions), variables and wildcards. With a <i>wildcard</i> one can indicate that one is not interested in certain components.</p>
<p style="text-align:justify;">Selectors cannot be defined globally. They can only locally be defined in a let (<span style="color:blue;"><a href="#_3.5.1">see 3.5.1</a></span>), a let-before (<span style="color:blue;"><a href="#_3.5.4">see 3.5.4</a></span>), a where-block (<span style="color:blue;"><a href="#_3.5.2">see 3.5.2</a></span>), and a with-block (<span style="color:blue;"><a href="#_3.5.3">see 3.5.3</a></span>). Selectors can furthermore appear on the left-hand side of generators in list comprehensions (<span style="color:blue;"><a href="CleanLanguageReport4.html#_4.2.1">see 4.2.1</a></span>) and array comprehensions (<span style="color:blue;"><a href="CleanLanguageReport4.html#_4.4.1">see 4.4.1</a></span>).</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Selector</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:27.0690909090909%;padding:0 0 4px 0;">BrackPattern</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:42.78%;padding:0 0 4px 0;">// <span style="color:blue;"><a href="#_3.2">for bracket patterns see 3.2</a></span></td></tr>
</table><p></p>
<p></p><div style="background-color:#FFFF45;">Use of a selector to locally select tuple elements.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
unzip::[(a,b)]&nbsp;-&gt;&nbsp;([a],[b])<br>
unzip&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],[])<br>
unzip&nbsp;[(x,y):xys]&nbsp;=&nbsp;([x:xs],[y:ys])<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(xs,ys)&nbsp;=&nbsp;unzip&nbsp;xys<br></div>
<p></p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When a selector on the left-hand side of a graph definition is not matching the graph on the right-hand side it will result in a <i>run-time</i> error.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The selector variables introduced in the selector must be different from each other and not already be used in the same scope and name space (<span style="color:blue;"><a href="CleanLanguageReport1.html#_1.2">see 1.2</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">To avoid the specification of patterns that may fail at run-time, it is not allowed to test on zero arity constructors. For instance, list used in a selector pattern need to be of form <span style="font-family:courier;">[a:_]</span>. <span style="font-family:courier;">[a]</span> cannot be used because it stands for <span style="font-family:courier;">[a:[]]</span> implying a test on the zero arity constructor <span style="font-family:courier;">[]</span>. If the pattern is a record only those fields which contents one is interested in need to be indicated in the pattern</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Arrays cannot be used as pattern in a selector.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Selectors cannot be defined globally.</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_3.7">3.7 Typing Functions</a></h2>
<p style="text-align:justify;">Although one is in general not obligated to explicitly specify the type of a function (the CLEAN compiler can in general <span style="font-family:courier;">infer</span> the type) the explicit specification of the type is <span style="font-family:courier;">highly recommended</span> to increase the readability of the program.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[FunctionTypeDef]</td></tr>
<tr><td style="width:26.1111111111111%;padding:0 0 4px 0;" colspan="3"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">DefOfFunction</td></tr>
<tr><td style="width:100.000404040404%;padding:0 0 4px 0;" colspan="5"></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionTypeDef</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span> [FixPrec] [<span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FixPrec</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#FF0000;"><b>infixl</b></span> [Prec]</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#FF0000;"><b>infixr</b></span> [Prec]</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#FF0000;"><b>infix</b></span> [Prec]</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Prec</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">Digit</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionType</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[{ArgType}+ <span style="font-family:courier;color:#993300;"><b>-&gt;</b></span>] Type [ClassContext] [UnqTypeUnEqualities]</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">ArgType</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UnivQuantVariables Type [ClassContext]<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Type</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{BrackType}+</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">BrackType</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">UnivQuantVariables</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">An explicit specification is <span style="font-family:courier;">required</span> when a function is exported, or when the programmer wants to impose additional restrictions on the application of the function (e.g. a more restricted type can be specified, strictness information can be added as explained in <span style="color:blue;"><a href="CleanLanguageReport10.html#_10.1">Chapter 10.1</a></span>, a class context for the type variables to express overloading can be defined as explained in <span style="color:blue;"><a href="CleanLanguageReport7.html#_7">Chapter 7</a></span>, uniqueness information can be added as explained in 3.7.5 Functions with Strict Arguments).</p>
<p style="text-align:justify;">The CLEAN type system uses a combination of Milner/Mycroft type assignment. This has as consequence that the type system in some rare cases is not capable to infer the type of a function (using the Milner/Hindley system) although it will approve a given type (using the Mycroft system; see Plasmeijer and Van Eekelen, 1993). Also when universally quantified types of rank 2 are used (<span style="color:blue;"><a href="#_3.7.4">see 3.7.4</a></span>), explicit typing by the programmer is required.</p>
<p style="text-align:justify;">The Cartesian product is used for the specification of the function type. The Cartesian product is denoted by juxtaposition of the bracketed argument types. For the case of a single argument the brackets can be left out. In type specifications the binding priority of the application of type constructors is higher than the binding of the arrow <span style="font-family:courier;">-&gt;</span>. To indicate that one defines an operator the function name is on the left-hand side surrounded by brackets.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The function symbol before the double colon should be the same as the function symbol of the corresponding rewrite rule.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The arity of the functions has to correspond with the number of arguments of which the Cartesian product is taken. So, in CLEAN one can tell the arity of the function by its type.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">Showing how the arity of a function is reflected in type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::&nbsp;(a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;map&nbsp;has&nbsp;arity&nbsp;2</span><br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;[]<br>
map&nbsp;f&nbsp;[x:xs]&nbsp;=&nbsp;&nbsp;&nbsp;[f&nbsp;x&nbsp;:&nbsp;map&nbsp;f&nbsp;xs]<br>
<br>
domap::&nbsp;((a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;domap&nbsp;has&nbsp;arity&nbsp;zero</span><br>
domap&nbsp;=&nbsp;map<br></div>
<p></p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The arguments and the result types of a function should be of kind <span style="font-family:courier;">X</span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In the specification of a type of a locally defined function one cannot refer to a type variable introduced in the type specification of a surrounding function (there is not yet a scope rule on types defined). The programmer can therefore not specify the type of such a local function. However, the type will be inferred and checked (after it is lifted by the compiler to the global level) by the type system.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">Counter example (illegal type specification). The function <span style="font-family:courier;">g</span> returns a tuple. The type of the first tuple element is the same as the type of the polymorphic argument of <span style="font-family:courier;">f</span>. Such a dependency (here indicated by "<span style="font-family:courier;">^</span><span style="font-family:courier;">" cannot be specified).</span></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
f::&nbsp;a&nbsp;-&gt;&nbsp;(a,a)<br>
f&nbsp;x&nbsp;=&nbsp;g&nbsp;x<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;g::&nbsp;b&nbsp;-&gt;&nbsp;(a^,b)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;y&nbsp;=&nbsp;(x,y)<br></div>
<p></p><h3 style="background-color:#9999FF;"><a id="_3.7.1">3.7.1 Typing Curried Functions </a></h3>
<p style="text-align:justify;">In CLEAN all symbols (functions and constructors) are defined with <i>fixed arity</i>. However, in an application it is of course allowed to apply them to an arbitrary number of arguments. A <i>curried application</i> of a function is an application of a function with a number of arguments which is less than its arity (note that in CLEAN the arity of a function can be derived from its type). With the aid of the predefined internal function <i>_AP</i> a curried function applied on the required number of arguments is transformed into an equivalent uncurried function application.</p>
<p style="text-align:justify;">The type axiom's of the CLEAN type system include for all <span style="font-family:courier;">s</span> defined with arity <span style="font-family:courier;">n</span> the equivalence of <span style="font-family:courier;">s::(t1-&gt;(t2-&gt;(...(tn-&gt;tr)...))</span> with <span style="font-family:courier;">s::t1 t2 ... tn -&gt; tr</span>.</p>
<h3 style="background-color:#9999FF;"><a id="_3.7.2">3.7.2 Typing Operators</a></h3>
<p style="text-align:justify;">An <i>operator</i> is a <i>function with arity two</i> that can be used in infix position. An operator can be defined by enclosing the operator name between parentheses in the left-hand-side of the function definition. An operator has a <i>precedence</i> (<span style="font-family:courier;">0</span> through <span style="font-family:courier;">9</span>, default <span style="font-family:courier;">9</span>) and a <span style="font-family:courier;color:#FF0000;"><b>fixity</b></span> (<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>, <span style="font-family:courier;color:#FF0000;"><b>infixr</b></span> or just <span style="font-family:courier;color:#FF0000;"><b>infix</b></span>, default <span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>). A higher precedence binds more tightly. When operators have equal precedence, the fixity determines the priority. In an expression an ordinary function application always has the highest priority (<span style="font-family:courier;">10</span>). See also <span style="color:blue;"><a href="#_3.1">Section 3.1</a></span> and <span style="color:blue;"><a href="#_3.4">3.4</a></span>.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The type of an operator must obey the requirements as defined for typing functions with arity two.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">If the operator is explicitly typed the operator name should also be put between parentheses in the type rule.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When an infix operator is enclosed between parentheses it can be applied as a prefix function. Possible recursive definitions of the newly defined operator on the right-hand-side also follow this convention.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;">Example of an operator definition and its type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(o)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;8::&nbsp;(x&nbsp;-&gt;&nbsp;y)&nbsp;(z&nbsp;-&gt;&nbsp;x)&nbsp;-&gt;&nbsp;(z&nbsp;-&gt;&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;function&nbsp;composition<br>
(o)&nbsp;f&nbsp;g&nbsp;=&nbsp;\x&nbsp;-&gt;&nbsp;f&nbsp;(g&nbsp;x)<br></div>
<p></p><h3 style="background-color:#9999FF;"><a id="_3.7.3">3.7.3 Typing Partial Functions</a></h3>
<p style="text-align:justify;">Patterns and guards imply a condition that has to be fulfilled before a rewrite rule can be applied (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span> and <span style="color:blue;"><a href="#_3.3">3.3</a></span>). This makes it possible to define <i>partial function s</i>, functions which are not defined for all possible values of the specified type.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When a partial function is applied to a value outside the domain for which the function is defined it will result into a <i>run-time</i> error. The compiler gives a warning when functions are defined which might be partial.</td></tr>
</table>
<p style="text-align:justify;">With the <span style="font-family:courier;">abort</span> expression (see <span style="font-family:courier;">StdMisc.dcl</span>) one can change any partial function into a <i>total function</i> (the <span style="font-family:courier;">abort</span>expression can have any type). The abort expression can be used to give a user-defined run-time error message</p>
<p></p><div style="background-color:#FFFF45;">Use of abort to make a function total.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
fac::&nbsp;Int&nbsp;-&gt;&nbsp;Int<br>
fac&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br>
fac&nbsp;n<br>
|&nbsp;n&gt;=1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;n&nbsp;*&nbsp;fac&nbsp;(n&nbsp;-&nbsp;1)<br>
|&nbsp;otherwise&nbsp;&nbsp;=&nbsp;abort&nbsp;"fac&nbsp;called&nbsp;with&nbsp;a&nbsp;negative&nbsp;number"<br></div>
<p></p><h3 style="background-color:#9999FF;"><a id="_3.7.4">3.7.4 Explicit use of the Universal Quantifier in Function Types</a></h3>
<p style="text-align:justify;">When a type of a polymorphic function is specified in CLEAN, the universal quantifier is generally left out.</p>
<p></p><div style="background-color:#FFFF45;">The function <span style="font-family:courier;">map</span> defined as usual, no universal quantifier is specified:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::&nbsp;(a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;[]<br>
map&nbsp;f&nbsp;[x:xs]&nbsp;=&nbsp;&nbsp;&nbsp;[f&nbsp;x&nbsp;:&nbsp;map&nbsp;f&nbsp;xs]<br></div>
<p></p><p></p><div style="background-color:#FFFF45;"><b>Counter Example.</b> The same function <span style="font-family:courier;">map</span> again, but now the implicit assumed universal quantifier has been made visible. It shows the meaning of the specified type more precisely, but it makes the type definition a bit longer as well. <span style="color:#FF6600;"><b>The current version of Clean does not yet allow universal quantifiers on the topmost level !!</b></span></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::&nbsp;A.a&nbsp;b:&nbsp;(a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;[]<br>
map&nbsp;f&nbsp;[x:xs]&nbsp;=&nbsp;&nbsp;&nbsp;[f&nbsp;x&nbsp;:&nbsp;map&nbsp;f&nbsp;xs]<br></div>
<p></p><p style="text-align:justify;"><span style="color:#FF6600;"><b>Not yet Implemented:</b></span> In Clean 2.0 it is allowed to explicitly write down the universal quantifier. One can write down the qualifier A. (for all) direct after the :: in the type definition of a function. In this way one can explicitly introduce the type variables used in the type definition of the function. As usual, the type variables thus introduced have the whole function type definition as scope.</p>
<table style="background-color:#FFCC99;width:100%;" cellspacing="0" cellpadding="0"><tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">FunctionType</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[{ArgType}+ <span style="font-family:courier;color:#993300;"><b>-&gt;</b></span>] Type [ClassContext] [UnqTypeUnEqualities]</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">ArgType</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;"></td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">|</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UnivQuantVariables Type [ClassContext]<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">Type</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">{BrackType}+</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">BrackType</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;padding:0 0 4px 0;">UnivQuantVariables</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:1.06181818181818%;padding:0 0 4px 0;">=</td><td style="width:2.02020202020202%;padding:0 0 4px 0;"></td><td style="width:71.8690909090909%;padding:0 0 4px 0;"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">CLEAN offers Rank 2 polymorphism: it is possible to specify the universal quantifier with as scope the type of an argument of a function. This makes it possible to pass polymorphic functions as an argument to a function which otherwise would be treated monomorphic. The advantage of the use of Rank 2 polymorphism is that more programs will be approved by the type system, but one explicitly (by writing down the universal quantifier) has to specify in the type of function that such a polymorphic function is expected as argument or delivered as result.</p>
<p></p><div style="background-color:#FFFF45;">Example: The function <span style="font-family:courier;">h</span> is used to apply a polymorphic function of type <span style="font-family:courier;">(A.a: [a] -&gt; Int)</span> to a list of <span style="font-family:courier;">Int</span>as well as a list of <span style="font-family:courier;">Char</span>. Due to the explicit use of the universal quantifier in the type specification of <span style="font-family:courier;">h</span> this definition is approved.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h::&nbsp;(A.a:&nbsp;[a]&nbsp;-&gt;&nbsp;Int)&nbsp;-&gt;&nbsp;Int<br>
h&nbsp;f&nbsp;=&nbsp;f&nbsp;[1..100]&nbsp;+&nbsp;f&nbsp;['a'..'z']<br>
<br>
Start&nbsp;=&nbsp;h&nbsp;length<br></div>
<p></p><p></p><div style="background-color:#FFFF45;"><b>Counter Example:</b> The function <span style="font-family:courier;">h2</span> is used to apply a function of type <span style="font-family:courier;">([a] -&gt; Int)</span> to a list of Int as well as a list of <span style="font-family:courier;">Char</span>. In this case the definition is rejected due to a type unification error. It is assumed that the argument of <span style="font-family:courier;">h2</span> is unifiable with <span style="font-family:courier;">[a] -&gt; Int</span>, but it is not assumed that the argument of <span style="font-family:courier;">h2</span> is <span style="font-family:courier;">(A.a: [a] -&gt; Int)</span>. So, the type variable a is unified with both <span style="font-family:courier;">Int</span> and <span style="font-family:courier;">Char</span>, which gives rise to a type error.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h2::&nbsp;([a]&nbsp;-&gt;&nbsp;Int)&nbsp;-&gt;&nbsp;Int<br>
h2&nbsp;f&nbsp;=&nbsp;f&nbsp;[1..100]&nbsp;+&nbsp;f&nbsp;['a'..'z']<br>
<br>
Start&nbsp;=&nbsp;h2&nbsp;length<br></div>
<p></p><p></p><div style="background-color:#FFFF45;"><b>Counter Example: </b>The function h3 is used to apply a function to a list of <span style="font-family:courier;">Int</span> as well as a list of <span style="font-family:courier;">Char</span>. Since no type is specified the type inference system will assume <span style="font-family:courier;">f</span> to be of type <span style="font-family:courier;">([a] -&gt; Int)</span> but not of type <span style="font-family:courier;">(A.a: [a] -&gt; Int)</span>. The situation is the same as above and we will again get a type error.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h3&nbsp;f&nbsp;=&nbsp;f&nbsp;[1..100]&nbsp;+&nbsp;f&nbsp;['a'..'z']<br>
<br>
Start&nbsp;=&nbsp;h3&nbsp;length<br></div>
<p></p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN cannot infer polymorphic functions of Rank 2 automatically! One is obligated to explicitly specify universally quantified types of Rank 2.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Explicit universal quantification on higher ranks than rank 2 (e.g. quantifiers specified somewhere inside the type specification of a function argument) is not allowed.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A polymorphic function of Rank 2 cannot be used in a curried way for those arguments in which the function is universally quantified.</td></tr>
</table>
<p></p><div style="background-color:#FFFF45;"><b>Counter Examples:</b> In the example below it is shown that <span style="font-family:courier;">f1</span> can only be used when applied to <i>all</i> its arguments since its last argument is universally quantified. The function <span style="font-family:courier;">f2</span> can be used curried only with respect to its last argument that is not universally quantified.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
f1::&nbsp;a&nbsp;(A.b:b-&gt;b)&nbsp;-&gt;&nbsp;a<br>
f1&nbsp;x&nbsp;id&nbsp;=&nbsp;id&nbsp;x<br>
<br>
f2::&nbsp;(A.b:b-&gt;b)&nbsp;a&nbsp;-&gt;&nbsp;a<br>
f2&nbsp;id&nbsp;x&nbsp;=&nbsp;id&nbsp;x<br>
<br>
illegal1&nbsp;=&nbsp;f1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;this&nbsp;will&nbsp;raise&nbsp;a&nbsp;type&nbsp;error</span><br>
<br>
illegal2&nbsp;=&nbsp;f1&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;this&nbsp;will&nbsp;raise&nbsp;a&nbsp;type&nbsp;error</span><br>
<br>
legal1&nbsp;::&nbsp;Int<br>
legal1&nbsp;=&nbsp;f1&nbsp;3&nbsp;id&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;id&nbsp;x&nbsp;=&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;ok</span><br>
<br>
illegal3&nbsp;=&nbsp;f2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;this&nbsp;will&nbsp;raise&nbsp;a&nbsp;type&nbsp;error</span><br>
<br>
legal2&nbsp;::&nbsp;(a&nbsp;-&gt;&nbsp;a)<br>
legal2&nbsp;=&nbsp;f2&nbsp;id&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;id&nbsp;x&nbsp;=&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;ok</span><br>
<br>
legal3&nbsp;::&nbsp;Int<br>
legal3&nbsp;=&nbsp;f2&nbsp;id&nbsp;3&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;id&nbsp;x&nbsp;=&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;ok</span><br></div>
<p></p><h3 style="background-color:#9999FF;"><a id="_3.7.5">3.7.5 Functions with Strict Arguments </a></h3>
<p style="text-align:justify;">In the type definition of a function the arguments can optionally be annotated as being strict. In reasoning about functions it will always be true that the corresponding arguments will be in strong root normal form (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2.1">see 2.1</a></span>) before the rewriting of the function takes place. In general, strictness information will increase the efficiency of execution (<span style="color:blue;"><a href="CleanLanguageReport10.html#_10">see Chapter 10</a></span>).</p>
<p></p><div style="background-color:#FFFF45;">Example of a function with strict annotated arguments.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Acker::&nbsp;!Int&nbsp;!Int&nbsp;-&gt;&nbsp;Int<br>
Acker&nbsp;0&nbsp;j&nbsp;=&nbsp;&nbsp;inc&nbsp;j<br>
Acker&nbsp;i&nbsp;0&nbsp;=&nbsp;&nbsp;Acker&nbsp;(dec&nbsp;i)&nbsp;1<br>
Acker&nbsp;i&nbsp;j&nbsp;=&nbsp;&nbsp;Acker&nbsp;(dec&nbsp;i)&nbsp;(Acker&nbsp;i&nbsp;(dec&nbsp;j))<br></div>
<p></p><p style="text-align:justify;">The CLEAN compiler includes a fast and clever strictness analyzer that is based on abstract reduction (Ncker, 1993). The compiler can derive the strictness of the function arguments in many cases, such as for the example above. Therefore there is generally no need to add strictness annotations to the type of a function by hand. When a function is exported from a module (<span style="color:blue;"><a href="CleanLanguageReport2.html#_2">see Chapter 2</a></span>), its type has to be specified in the definition module. To obtain optimal efficiency, the programmer should also include the strictness information to the type definition in the definition module. One can ask the compiler to print out the types with the derived strictness information and paste this into the definition module.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Notice that strictness annotations are only allowed at the outermost level of the argument type. Strictness annotations inside type instances of arguments are not possible (with exception for some predefined types like tuples and lists). Any (part of) a data structure can be changed from lazy to strict, but this has to be specified in the type definition (<span style="color:blue;"><a href="CleanLanguageReport5.html#_5.1.6">see 5.1.6</a></span>).</td></tr>
</table>
</body>
</html>
